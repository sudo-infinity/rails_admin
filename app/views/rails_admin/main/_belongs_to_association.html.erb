<%
  collection = field.associated_collection.sort_by{|object| object.first}
  selected = field.bindings[:object].send(field.child_key)

  if selected.nil? && params["associations"]
    selected = params["associations"][field.child_key.to_param.pluralize].to_i
  end

  model_name = field.abstract_model.to_param
  associated_model = field.associated_model_config
  associated_model_name = associated_model.abstract_model.to_param
%>

<%= label_tag "#{model_name}_#{field.name}", field.label %>
<%= select model_name, field.child_key, collection, {:include_blank => true, :selected => selected}, :class => "#{field.child_key} selectField #{field.has_errors? ? "errorField" : nil}" %>

<%= link_to "Add new #{associated_model_name}", rails_admin_new_path(:model_name => associated_model_name ),  :remote => true, :class => "showAssociatedRecordForm"  %>