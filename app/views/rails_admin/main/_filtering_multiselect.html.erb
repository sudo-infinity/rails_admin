<%
  name = field.association[:name]
  collection = field.associated_collection.sort_by{|object| object.first}

  if params["associations"]
    selected = params["associations"][name].to_a.map{|o| o.to_i}
  else
    selected = field.bindings[:object].send(name).map{|o| o.id }
  end

%>
              <%= label_tag "associations_#{name}", field.label %>
              <%= select "associations", name, collection, { :selected => selected }, :class => "#{field.has_errors? ? "errorField" : nil}", :multiple => true %>
              <%= javascript_tag do %>
                $j(document).ready(function($){
                  $("#<%= "associations_#{name}" %>").filteringMultiselect({

                  });
                });
              <% end %>